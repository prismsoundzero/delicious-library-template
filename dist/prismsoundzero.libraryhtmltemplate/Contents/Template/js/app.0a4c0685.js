var lastFmKeyApiKey="",lastFmApiBase="https://ws.audioscrobbler.com/2.0/",spotifyClientId="";angular.module("musicApp",["ngSanitize","cfp.hotkeys","spotify","ui.bootstrap"]).config(["SpotifyProvider","$sceDelegateProvider",function(a,b){a.setClientId(spotifyClientId),b.resourceUrlWhitelist(["self","https://*.spotify.com/**"])}]);var sample=sample||void 0;angular.module("musicApp").controller("MusicListController",["$rootScope","$scope","$location","$filter","$http","$anchorScroll","hotkeys","Spotify",function(a,b,c,d,e,f,g,h){function i(a){b.models.selectedArtistSpotifyInfo=void 0,b.models.selectedArtistLastFmInfo=void 0,h.search(a,"artist").then(function(c){c.artists.total>0&&(b.models.selectedArtistSpotifyInfo=c.artists.items[0],k(),lastFmKeyApiKey&&e.get(lastFmApiBase,{params:{method:"artist.getinfo",artist:a,api_key:lastFmKeyApiKey,format:"json"}}).then(function(a){b.models.selectedArtistLastFmInfo=a.data.artist},function(a){console.error("lastFm",a)}))})}function j(a,c){b.models.selectedAlbumSpotifyInfo=void 0,b.models.selectedAlbumLastFmInfo=void 0,h.search("album:"+a+" artist:"+c,"album").then(function(d){d.albums.items&&d.albums.items[0]&&(b.models.selectedAlbumSpotifyInfo=d.albums.items[0],b.models.selectedAlbumSpotifyUrl="https://embed.spotify.com/?uri="+b.models.selectedAlbumSpotifyInfo.uri),lastFmKeyApiKey&&e.get(lastFmApiBase,{params:{method:"album.getInfo",artist:c,album:a,api_key:lastFmKeyApiKey,format:"json"}}).then(function(a){b.models.selectedAlbumLastFmInfo=a.data.album})})}function k(){if(b.models.selectedArtistSpotifyInfo.images){var a=b.models.selectedArtistSpotifyInfo.images[0];angular.forEach(b.models.selectedArtistSpotifyInfo.images,function(b){b.width>100&&b.height>100&&(a=b)}),b.models.selectedArtistSpotifyImage=a}}function l(){var a=[],c=[],d=[];angular.forEach(angular.element(".medium-item"),function(b){b=angular.element(b);var d={id:b.attr("data-uuid"),title:b.attr("title"),artist:b.attr("data-artist"),description:b.attr("data-description"),asin:b.attr("asin"),rating:b.attr("rating")};c.push(d),a.indexOf(d.artist)===-1&&a.push(d.artist)}),angular.forEach(angular.element(".shelf_selection").find("a"),function(a){a=angular.element(a),d.push({href:a.attr("href"),name:a.text(),selected:a.hasClass("selected")})}),angular.isDefined(sample)?(b.artists=sample.artists,b.items=sample.items,b.shelves=sample.shelves):(b.artists=a,b.items=c,b.shelves=d),b.loaded=!0}b.selectItem=function(a){b.models.selected=a,c.search({id:a.id})},b.selectArtist=function(a){c.search({artist:a}),i(a)},b.search=function(){c.search({q:b.models.query})},b.back=function(){c.search({})},b.changeLimit=function(a){b.models.currentPage=Math.floor((b.models.limitOffset+b.models.limit-1)/a)+1,b.models.limit=a,b.changePage()},b.changePage=function(){b.models.limitOffset=(b.models.currentPage-1)*b.models.limit,f("top")},a.$on("$locationChangeStart",function(){var e=c.search().artist,f=c.search().id,g=c.search().q;b.models.query=void 0,e?(b.models.selectedArtist=e,a.title=e,i(e)):b.models.selectedArtist=void 0,f?(b.models.selected&&b.models.selected.id===f||(b.models.selected=d("filter")(b.items,{id:f},!0)[0]),j(b.models.selected.title,b.models.selected.artist),a.title=b.models.selected.title+" | "+b.models.selected.artist):b.models.selected=void 0,g?(b.models.q=g,a.title="Search: "+g):b.models.q=void 0,e||f||g||(a.title=void 0)}),g.add({combo:"mod+f",description:"Search",allowIn:["INPUT"],callback:function(a){a.preventDefault(),angular.element("#search").focus()}}),g.add({combo:"esc",description:"Clear search",allowIn:["INPUT"],callback:function(a){a.preventDefault(),b.models.query=void 0}}),function(){b.models={},b.items=[],b.shelves=[],b.models.limits=[25,50,100],b.models.limit=50,b.models.limitOffset=0,b.models.currentPage=1,l()}()}]),angular.module("musicApp").directive("copyValue",function(){return{restrict:"A",scope:{model:"="},link:function(a,b){a.model=b.text()}}}),angular.module("musicApp").run(["$templateCache",function(a){"use strict";a.put("html/item-match.html",'<a href tabindex="-1" ng-attr-title="{{match.label}}"> <span ng-bind-html="match.label.artist | uibTypeaheadHighlight:query"></span> <br> <small ng-bind-html="match.label.title | uibTypeaheadHighlight:query"></small> </a> '),a.put("html/pagination.html",'<button ng-if="::boundaryLinks" class="btn btn-secondary pagination-first" ng-click="selectPage(1, $event)" ng-disabled="noPrevious()||ngDisabled" uib-tabindex-toggle>{{::getText(\'first\')}}</button> <button ng-if="::directionLinks" class="btn btn-secondary pagination-prev" ng-click="selectPage(page - 1, $event)" ng-disabled="noPrevious()||ngDisabled" uib-tabindex-toggle>{{::getText(\'previous\')}}</button> <button ng-repeat="page in pages track by $index" ng-class="{active: page.active,disabled: ngDisabled&&!page.active}" class="btn btn-secondary pagination-page" ng-click="selectPage(page.number, $event)" ng-disabled="ngDisabled&&!page.active" uib-tabindex-toggle>{{page.text}}</button> <button ng-if="::directionLinks" class="btn btn-secondary pagination-next" ng-click="selectPage(page + 1, $event)" ng-disabled="noNext()||ngDisabled" uib-tabindex-toggle>{{::getText(\'next\')}}</button> <button ng-if="::boundaryLinks" class="btn btn-secondary pagination-last" ng-click="selectPage(totalPages, $event)" ng-disabled="noNext()||ngDisabled" uib-tabindex-toggle>{{::getText(\'last\')}}</button>')}]);